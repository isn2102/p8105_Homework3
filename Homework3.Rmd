---
title: "Homework3"
author: "Isabel Nelson"
date: "10/6/2020"
output: github_document
---

```{r setup, include=FALSE}
library(p8105.datasets)
library(tidyverse)

# Set how graphs are printed in knitted file
knitr::opts_chunk$set(
  fig.width = 8,
  fig.asp = .6,
  out.width = "90%"
)

#Set global theme for plots
theme_set(theme_minimal() + theme(legend.position = "bottom"))

#Set options for all plots
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

#Set options for all plots
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1 

Describe the data: 
```{r}
data("instacart")
```

The dataset instacart contains `r nrow(instacart)` observations and `r ncol(instacart)` columns. Observations are at the level of items in orders placed by users. The variables provide information about the users/orders and the items purchased. For example aisle contains values such as "fresh vegetables" and "eggs," product_name contains values such as "spring water" and "organic half and half" and days_since_prior_order is numeric. The total list of variables is: `r colnames(instacart)`. 

Count aisles: 
```{r}
instacart %>% 
  count(aisle) %>% 
  arrange(desc(n))
```
There are 134 aisles, with most items ordered from the fresh fruits and fresh vegetables aisles. 

Make a plot of aisles: 
```{r}
instacart %>% 
  count(aisle) %>% 
  filter(n > 10000) %>% 
  mutate(
    aisle = factor(aisle), 
    aisle = fct_reorder(aisle, n)
    ) %>% 
  ggplot(aes(x = aisle, y = n)) + 
  geom_point() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

Most of the aisles with order counts above 10,000 show between 10k - 20k orders. There are about 8 aisles with order counts between 20-40k, 3 aisles with order counts between 40-80k, and two aisles (fruit and vegetables) with order counts around 150k.

Make a table of popular items:
```{r}
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  filter(rank < 4) %>% 
  arrange(aisle, rank) %>% 
  knitr::kable()
```
The most popular items in baking are brown sugar, baking soda, and cane sugar. The most popular items in dog food care are snack sticks, organix chicken recipe, and small dog biscuits. The most popular items in packaged fruits/veggies are baby spinach, raspberries, and blueberries. 

Make a table for mean hour of product ordered on each day of the week:
```{r}
instacart %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>% 
  summarize(mean_hour = mean(order_hour_of_day)) %>% 
  pivot_wider(
    names_from = order_dow, 
    values_from = mean_hour
  )
```
Overall coffee ice cream is ordered a little later in the day on weekdays (around 3pm), while pink lady apples are ordered a little earlier in the day (around noon). On weekends both products on average are ordered around 12pm. 

## Problem 2

Load data and tidy by cleaning variable names and pivoting to longer with one variable for the minute of activity in the day and one variable for the activity count in that minute. Add a weekend and weekday variable and change minute of activity to numeric. 
```{r, message = FALSE}
accel_df <- read_csv("./data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    activity_1:activity_1440,
    names_to = "minute_activity", 
    values_to = "activity_count") %>% 
    {mutate(., weekend = (ifelse(pull(., day_id) %in% c("3", "4"), 
                                 "weekend", "weekday")))} %>% 
  mutate(minute_activity = rep((1:1440), times = 35))
```
The dataset accel_df contains `r nrow(accel_df)` observations and `r ncol(accel_df)` variables. Variables are the week, the day, the specific minute of the day, the activity count in that minute, and whether it was a weekend or a weekday. 

Create a table with daily activity counts summed across all minutes for the 5 weeks. 
**FACTOR RELVEL NOT WORKING**
```{r, message = FALSE}
accel_df %>% 
  group_by(week, day) %>% 
  summarize(
    daily_activity = sum(activity_count)) %>% 
  mutate(day = as.factor(day)) %>% 
  mutate(day = (forcats::fct_relevel(day, c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")))) %>% 
  pivot_wider(
    names_from = day, 
    values_from = daily_activity) %>% 
  knitr::kable()
```
From this summary it seems that in weeks 4 and 5 the activity on Sunday and particularly Saturday was lower than the other days and weeks. Other than that trends are not very apparent. 

```{r, message = FALSE}

```


Make a single plot (connected scatter dots, geom_line) with lines for each day (minute on x, activity count on the y), aesthetic mapping for color for day of the week 

## Problem 3

use count for snowfall. 

data manipulation (group a bunch, filter, then summarize) + plots. For each station (multiple lines), time course over the years for June and July in two panels

use patchwork to merge plots. Don't use scatterplot, maybe use contour plot, bin plot, hex plot... 

First filter, then show distribution (ridge, box, violin, etc...) for each year. 
